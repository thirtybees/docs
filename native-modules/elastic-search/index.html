<!DOCTYPE html>
<head>

	<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content="ElasticsearchsearchfilteringNative modules,  ">
<title>Elasticsearch by thirty bees | thirty bees documents</title>
<link rel="stylesheet" type="text/css" href="/css/syntax.css">
<link rel="stylesheet" type="text/css" href="/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="/css/base-theme.css">
<link rel="stylesheet" type="text/css" href="/css/modern-business.css">
<link rel="stylesheet" type="text/css" href="/css/customstyles.css">
<link rel="stylesheet" type="text/css" href="/css/algolia.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.1/css/bootstrap-select.min.css">
<link rel="stylesheet" type="text/css" href="/css/modern-business.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
<script src="/js/jquery.navgoco.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="/js/toc.js"></script>
<script src="/js/customscripts.js"></script>
<link rel="shortcut icon" href="/common_images/favicon.ico" type="image/x-icon">
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<script type="text/javascript">
    $(document).ready(function () {
        var body = document.body,
            html = document.documentElement;

        var height = Math.max(body.scrollHeight, body.offsetHeight,
            html.clientHeight, html.scrollHeight, html.offsetHeight) + 200;

        if (typeof window.top !== 'undefined') {
            window.top.postMessage({
                    inlineHelpHeight: height
                },
                '*'
            );
        }
    });
</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-89925901-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-89925901-1');
</script>





	<script>
      $(function () {
        $('[data-toggle="tooltip"]').tooltip()
      });
	</script>

	

</head>

<body class="page-template-default page page-id-1 fusion-body no-tablet-sticky-header no-mobile-sticky-header no-mobile-slidingbar no-mobile-totop mobile-logo-pos-center layout-wide-mode fusion-top-header menu-text-align-center mobile-menu-design-modern fusion-image-hovers fusion-show-pagination-text customize-support do-animate">

<!-- Navigation -->
<nav class="navbar navbar-inverse" role="navigation">
	<div class="container topnavlinks">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>

			<a class="navbar-brand" href="https://docs.thirtybees.com">
				<img src="https://docs.thirtybees.com/common_images/thirty-bees-dark.png" alt="thirty bees documents" style="margin-top: -16px; height: 50px; float: left;"><span class="brand-extra" style="float: left;margin-left: -8px; color: #000;font-size: 14px;line-height:26px">/merchants</span>
			</a>

		</div>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav navbar-right">
				<!-- entries without drop-downs appear here -->
				<!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
				




				
				
				
				
				<li><a href="https://thirtybees.com/" target="_blank">Website</a></li>
				
				
				
				
				
				<li><a href="https://github.com/thirtybees/ThirtyBees" target="_blank">Github Repo</a></li>
				
				
				
				
				
				<li><a href="/supporters/">Supporters</a></li>
				
				
				
				


				<!-- entries with drop-downs appear here -->
				<!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->

				<li class="dropdown">
					


				<!-- special insertion -->

				
				<!-- Send feedback function -->
<script>
  function SendLinkByMail(href) {
    var subject = "thirty bees documents feedback";
    var body = "I have some feedback about the Elasticsearch by thirty bees page: ";
    body += window.location.href;
    body += "";
    var uri = "mailto:contact@thirtybees.com?subject=";
    uri += encodeURIComponent(subject);
    uri += "&body=";
    uri += encodeURIComponent(body);
    window.location.href = uri;
  }
</script>

<li><a href="mailto:contact@thirtybees.com"><i class="fa fa-envelope-o"></i> Feedback</a></li>



				<li id="search-box">
					<div class="form-group" style="margin-bottom: -6px">
						<input id="algolia-search" type="text" class="form-control col-lg-4" placeholder="Search" style="margin: 8px; float: left">
					</div>
				</li>

				<li id="algolia-box">
					<a href="https://algolia.com" target="_blank" class="col-lg-2" id="algolia-svg-link" style="background: transparent; float:left; cursor: pointer">
						<img id="algolia-svg" src="https://docs.thirtybees.com/common_images/algolia.png">
					</a>
				</li>
				<script>
                  var client = algoliasearch("PIVL0Y1GI8", "8e047928cc6047d49bbb083d194c552d");
                  var index = client.initIndex('thirtybees_docs');
                  autocomplete('#algolia-search',
                    { hint: false }, {
                      source: autocomplete.sources.hits(index, { hitsPerPage: 5 }),
                      debug: true,
                      //value to be displayed in input control after user's suggestion selection
                      displayKey: function (suggestion) {
                        return suggestion.title || suggestion.h1 || suggestion.h2 || suggestion.h3 || suggestion.h4 || suggestion.h5 || suggestion.h6 || suggestion.unordered;
                      },
                      //hash of templates used when rendering dataset
                      templates: {
                        //'suggestion' templating function used to render a single suggestion
                        suggestion: function (suggestion) {
                          return '<span>' + suggestion.title || suggestion.h1 || suggestion.h2 || suggestion.h3 || suggestion.h4 || suggestion.h5 || suggestion.h6 || suggestion.unordered + '</span>';
                        }
                      }
                    }).on('autocomplete:selected', function (event, suggestion, dataset) {
                    if (suggestion.title) {
                      window.location.href = suggestion.permalink;
                    }

                    window.location.href = suggestion.url;
                  });
				</script>
			</ul>
		</div>
	</div>
</nav>



<!-- Page Content -->
<div class="container">
	<div class="col-lg-12">&nbsp;</div>


	<!-- Content Row -->
<div class="row">
    <!-- Sidebar Column -->
    <div class="col-md-3">
        <script>
            $(document).ready(function() {
                // Initialize navgoco with default options
                $("#mysidebar").navgoco({
                    caretHtml: '',
                    accordion: true,
                    openClass: 'active', // open
                    save: false, // leave false or nav highlighting doesn't work right
                    cookie: {
                        name: 'navgoco',
                        expires: false,
                        path: '/'
                    },
                    slide: {
                        duration: 400,
                        easing: 'swing'
                    }
                });

                $("#collapseAll").click(function(e) {
                    e.preventDefault();
                    $("#mysidebar").navgoco('toggle', false);
                });

                $("#expandAll").click(function(e) {
                    e.preventDefault();
                    $("#mysidebar").navgoco('toggle', true);
                });

            });
        </script>
        



        <ul id="mysidebar" class="nav">
         <!--   <span class="siteTagline">Developer<br />Guide</span> -->
            <span class="versionTagline">Version 1.0.X</span>
            
            
            
                
            
            <li><a href="#">Overview</a>
                <ul>
                    
                    
                    
                    <li><a href="/">Introduction</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Installation</a>
                <ul>
                    
                    
                    
                    <li><a href="/installation/">General Requirements</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/installation/ftp-installation/">FTP Installation</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/installation/command-line/">Command Line Installation</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/installation/migration/">Shopping Cart Migrations</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Troubleshooting</a>
                <ul>
                    
                    
                    
                    <li><a href="/troubleshooting/decoding-error-messages/">Decoding Error Messages</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Merchants Guide</a>
                <ul>
                    
                    
                    
                    <li><a href="/merchants-guide/">Getting started</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/merchants-guide/online-resources/">Online Resources</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/merchants-guide/admin-area/">Back Office</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/merchants-guide/admin-products/">Admin Product Page</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Native Modules</a>
                <ul>
                    
                    
                    
                    <li><a href="/native-modules/advanced-eu-compliance/">Advanced EU Compliance</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/apcu-manager/">APCu Cache Manger</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/bees-blog/">Bees Blog</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/custompayments/">Custom Payment Methods</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/dash-activity/">Dash Activity</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/dash-goals/">Dash Goals</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/donation-miner/">Donation Miner</a></li>
                    

                    

                    
                    
                    
                    
                    <li class="active"><a href="/native-modules/elastic-search/">Elasticsearch</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/eu-cookie-consent/">EU Cookie Consent</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/google-analytics/">Google Analytics</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/json-module/">JSON + LD Module</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/mailchimp/">MailChimp</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/memcache-manager/">Memcache Manager</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/nocaptcharecaptcha/">No CAPTCHA reCAPTCHA</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/opcache-manager/">Opcache Manager</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/paypal/">PayPal</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/piwik/">Piwik</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/stripe/">Stripe</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/tawkto/">tawk.to</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/native-modules/tb-updater/">thirty bees updater</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">SEO Guide</a>
                <ul>
                    
                </ul>
                
                
            
            <li><a href="#">Developers Guide</a>
                <ul>
                    
                    
                    
                    <li><a href="/developers/classes/">Classes API</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/developers/controllers/">Controllers API</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Designers Guide</a>
                <ul>
                    
                </ul>
                
                
            
            <li><a href="#">Module Makers Guide</a>
                <ul>
                    
                </ul>
                
                
            
            <li><a href="#">System Administration Guide</a>
                <ul>
                    
                </ul>
                
                
            
            <li><a href="#">Store</a>
                <ul>
                    
                    
                    
                    <li><a href="/store/free-modules/">List Free Modules</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/store/paid-modules/">List Paid Modules</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Contribute</a>
                <ul>
                    
                    
                    
                    <li><a href="/contributing/">Contributing</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/first-pull-request/">Making Your First Pull Request</a></li>
                    

                    

                    
                    
                    
                    
                    <li><a href="/bug-reporting/">Bug Reporting</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Release notes</a>
                <ul>
                    
                    
                    
                    <li><a href="/release_notes/v1-0-x-release-notes">Version 1.0.x</a></li>
                    

                    

                    
                    
                </ul>
                
                
            
            <li><a href="#">Reporting Bugs</a>
                <ul>
                    
                </ul>
                
                
                


                <!-- if you aren't using the accordion, uncomment this block:

                     <p class="external">
                         <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
                     </p>
                 -->
                <br />
                <p class="external">
                    <a href="https://www.patreon.com/thirtybees" target="_blank" class="no-padding"><img src="/common_images/patreon-banner.png" /></a>
                </p>
    </div>
    <!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
    <script>$("li.active").parents('li').toggleClass("active");</script>


	<!-- Content Column -->
	<div class="col-md-9">
		<!--<div class="search">

	<input type="text" placeholder="search...">
</div>
<div class="results">
	<ul id="users"></ul>
</div>

<script src="http://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>

<script>
  $(document).ready(function () {
    var client = algoliasearch('PIVL0Y1GI8', '');
    var index = client.initIndex('thirtybees_docs');
    var $input = $('input');
    $input.keyup(function () {
      index.search($input.val(), {
        hitsPerPage: 10,
        facets: '*'
      }, searchCallback);
    }).focus();
  });

  function searchCallback(err, content) {
    console.log(content);
    if (err) {
      console.error(err);
      return;
    }

    var $users = $('#users');
    $users.empty();

    for (var i = 0; i < content.hits.length; i++) {
      $users.append('<li> <a href="' + content.hits[i].url + '">' + content.hits[i].title + '</a></li>');
    }
  };
</script>
-->
		<div class="post-header">
    <h1 class="post-title-main">Elasticsearch by thirty bees</h1>
</div>

<div class="post-content">

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>


<div id="toc"></div>


    
    <a target="_blank" href="https://github.com/thirtybees/devdocs/blob/master/thirtybees/native-modules/elasticsearch.md" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>
    

    <h1 id="elasticsearch-beta">Elasticsearch beta</h1>

<blockquote>
<p>NOTE: This module is currently in beta and the documentation is still being written</p>
</blockquote>

<p>This page how you can install and run the Elasticsearch module on your thirty bees store. It only covers the basics of installing Elasticsearch. If you want to know more about how to install or use your Elasticsearch server directly please refer to the comprehensive <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">Elasticsearch documentation</a>.</p>

<h2 id="compatibility">Compatibility</h2>

<h3 id="module-requirements">Module requirements</h3>

<p>This module deviates a bit from the basic thirty bees system requirements. The additional requirements are:<br>
- PHP 5.6 or higher instead of PHP 5.5
- PHP cURL extension -- not required for thirty bees, but is needed in this case in order to communicate with the Elasticsearch server</p>

<blockquote>
<p><strong>Beta NOTE</strong>: For beta 1 and beta 2, make sure you have disabled the CCC JavaScript option. It is not supported by these versions.</p>
</blockquote>

<h3 id="elasticsearch-requirements">Elasticsearch requirements</h3>

<p>In order to provide an extremely fast and easy search we stick with the latest versions of Elasticsearch,
in order to provide you with all the state-of-the-art search functionality Elasticsearch has to offer.</p>

<p>Therefore, at the moment of writing, you will need a version of Elasticsearch that is:<br>
- Version 5.4 or higher, including 6.0</p>

<p>Anything lower is not supported and will likely not work.</p>

<p>Please double check if your system satisfies these requirements before proceeding.</p>

<h2 id="installing-elasticsearch">Installing Elasticsearch</h2>

<h3 id="thirty-bees-cloud-cloudways">thirty bees cloud (Cloudways)</h3>

<p>An easy way to use Elasticsearch + thirty bees is by hosting both with Cloudways.
If you already have an instance on Cloudways, you can simply navigate to your Cloudways dashboard, select Server mode (top-left) &gt; Server Magement &gt; Settings &amp; Packages &gt; Packages.
On this tab you can choose to enable Elasticsearch 5.4.</p>

<p><img src="/thirtybees/images/merchants-guide/native-modules/elasticsearch/cloudwaysservers.png" alt="Cloudways servers" title="Cloudways server page"> </p>

<h3 id="plesk-docker">Plesk + docker</h3>

<p>This is a basic configuration example to show you how you can configure your server for Elasticsearch. Elasticsearch is a two-part system.
You will need to run an Elasticsearch server (separate Java application) and install the Elasticsearch module in thirty bees.  </p>

<p>We will be proxying Elasticsearch via nginx in this example. Basically the module itself connects directly to the Elasticsearch server and the frontend JavaScript widget will connect via the nginx proxy. This ensures that you will get the fastest possible search.
To make things easier we will be setting up this server via Docker and Plesk. If you would like to go cli style, you might also be able to follow this documentation, but you will have to figure out the command line alternatives to what Plesk does.</p>

<p>First, start by searching and launching an Elasticsearch docker:
<img src="/thirtybees/images/merchants-guide/native-modules/elasticsearch/searchforelasticsearch.png" alt="docker" title="thirty bees elasticsearch docker"></p>

<p>Plesk will make this instance run on a random port number. Remember this number, you will need it later.  </p>

<p>Add a search subdomain of your choice via Plesk. Make sure it does not run in proxy mode (<code>Proxy mode</code> unticked). These are the additional nginx directives you will need to secure and expost Elasticsearch:  </p>

<p><a name="nginx-config"></a>  </p>
<div class="highlight"><pre><code class="language-nginx" data-lang="nginx"><span></span><span class="k">add_header</span> <span class="s">Access-Control-Allow-Origin</span> <span class="s">*</span> <span class="s">always</span><span class="p">;</span>
<span class="k">add_header</span> <span class="s">Access-Control-Allow-Methods</span> <span class="s">GET,HEAD,OPTIONS,POST,PUT</span> <span class="s">always</span><span class="p">;</span>
<span class="k">add_header</span> <span class="s">Access-Control-Allow-Headers</span> <span class="s">Access-Control-Allow-Headers,Origin,Accept,X-Requested-With,Content-Type,Access-Control-Request-Method,Access-Control-Request-Headers,Authorization</span> <span class="s">always</span><span class="p">;</span>

<span class="k">location</span> <span class="p">~</span><span class="sr">*</span> <span class="s">^/thirtybees_\d+_\d+(/_search|/_analyze)</span> <span class="p">{</span>
  <span class="kn">limit_except</span> <span class="s">HEAD</span> <span class="s">OPTIONS</span> <span class="p">{</span>
    <span class="kn">auth_basic</span>           <span class="s">&quot;Protected</span> <span class="s">Elasticsearch&quot;</span><span class="p">;</span>
    <span class="kn">auth_basic_user_file</span> <span class="s">/var/www/vhosts/example.com/elasticread</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kn">proxy_pass</span> <span class="s">http://localhost:9200</span><span class="p">;</span>
  <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
  <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&quot;Keep-Alive&quot;</span><span class="p">;</span>
  <span class="kn">proxy_set_header</span> <span class="s">Proxy-Connection</span> <span class="s">&quot;Keep-Alive&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">location</span> <span class="p">~</span> <span class="sr">/</span> <span class="p">{</span>
  <span class="kn">limit_except</span> <span class="s">HEAD</span> <span class="s">OPTIONS</span> <span class="p">{</span>
    <span class="kn">auth_basic</span>           <span class="s">&quot;Protected</span> <span class="s">Elasticsearch&quot;</span><span class="p">;</span>
    <span class="kn">auth_basic_user_file</span> <span class="s">/var/www/vhosts/example.com/elasticadmins</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kn">proxy_pass</span> <span class="s">http://localhost:9200</span><span class="p">;</span>
  <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
  <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&quot;Keep-Alive&quot;</span><span class="p">;</span>
  <span class="kn">proxy_set_header</span> <span class="s">Proxy-Connection</span> <span class="s">&quot;Keep-Alive&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>We have added two .htpasswd files in the directory <code>/var/www/vhosts/example.com</code>. On <a href="http://www.htaccesstools.com/htpasswd-generator/">this page</a> you can create an <code>.htpasswd</code> file.
The first location directive contains the index name, follow by two integers. Those two numbers are respectively the shop ID and language ID. Make sure the name corresponds with your index name, otherwise there will be no access from the frontend. 
Save these settings and go!</p>

<h3 id="cli">CLI</h3>

<p>We do not provide a tutorial for raw installation since it is basically expert mode and expert generally know what they are doing.
To give you a few guidelines, here are your possibilities:</p>

<h4 id="directly">Directly</h4>

<p>You can grab a copy from <a href="https://www.elastic.co/products/elasticsearch">the Elasticsearch download page</a> and run that one directly. It will by default run on port <code>9200</code>.</p>

<h4 id="docker">Docker</h4>

<p>You can grab a docker container directly, we recommend <code>elasticsearch/elasticsearch</code>. More instructions about using Elasticsearch with docker can be found at: https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html
You can control the ports of this instance and optionally place an nginx proxy in front.</p>

<p>After launching an Elasticsearch instance, feel free to continue with (a part of) the instructions from the Plesk section.
It contains an <a href="#nginx-config">nginx configuration</a> that allows you to expose a read-only URL of the Elasticsearch instance directly, so there is no need for a proxy via your thirty bees instance.
In practice this decreases the search delay with 50-200ms per query.</p>

<h2 id="installing-the-module">Installing the module</h2>

<p>Install the Elasticsearch module and configure the servers. By default the module picks one server located at <code>http://localhost:9200</code>.
This is Elasticsearch&#39;s default port and proxied by default so it is ready to be used in the frontend right from the start if you just installed Elasticsearch with the default settings on the same system.
This also works out of the box when you use the cloud version of thirty bees (Cloudways).</p>

<p>After installing the module some conflicting default modules might still be active. They also cause the Elasticsearch module to be displaced from the start.
In order to fix this, disable both the <code>blocksearch</code> and <code>blocklayered</code> modules.</p>

<p>To make the search block show in the previous position, navigate to <code>Modules and Services</code> &gt; <code>Positions</code> and search for the <code>displayTop</code> hook.
Make sure the Elasticsearch module is at the top.</p>

<p>Search facets will be shown on the left and right column. By default thirty bees will add the new blocks at the bottom. 
Search for <code>displayLeftColumn</code> &amp; <code>displayRightColumn</code> and reposition the module however you like.</p>

<p>Also make sure you have disabled the default search options on the page &quot;Preferences &gt; Search&quot;. They should look like this:
<img src="/thirtybees/images/merchants-guide/native-modules/elasticsearch/disablesearch.png" alt="search settings" title="search settings"></p>

<p>This should be enough to make the module show properly and on the right spot with supported themes.
If your theme is not supported by default or your theme does not take the Elasticsearch module into account you might have to grab one or more of the template (<code>.tpl</code>) and adjust them to your likings.</p>

<h3 id="upgrading-to-beta-2-from-beta-1">Upgrading to beta 2 from beta 1</h3>

<p>Note that there is no upgrade script to upgrade from beta 1 to beta 2. There is only one way to upgrade from beta 1.
Resets and changing files will not work; you will have to reinstall the module in order to upgrade,
even if you have previously uninstalled and/or removed beta 1 you will need to follow these guidelines:<br>
- Uninstall beta 1
- Upload beta 2 via you back office (not FTP!)
- Install beta 2
- Uninstall beta 2
- And install it again (do not use the reset button) </p>

<!---
### Upgrading to beta 4 from beta 3

Beta 4 also does not have an upgrade script. If you wish to update manually to beta 3, change the `PREFIX_elasticsearch_meta` database table first:  
- `` DROP INDEX code ON `PREFIX_elasticsearch_meta` ``
- `` ALTER TABLE `PREFIX_elasticsearch_meta` ADD alias VARCHAR(255) NOT NULL; ``

(replace `PREFIX` with your own prefix.)

You can now upload and run beta 3 via your back office.
--->

<h2 id="configuring-the-module">Configuring the module</h2>

<p>After installing the module you should be presented with the module&#39;s configuration page that has several options already configured for you by default.
In this section we will navigate through every tab and show what you can configure.</p>

<h3 id="settings-tab"><i class="fa fa-cogs"></i> Settings tab</h3>

<p>On the settings tab you will find generic Elasticsearch settings that do not belong on the other tabs.
You generally only touch these if you want to run multiple Elasticsearch instances, optimize them for performance or configure stop words.</p>

<h4 id="number-of-shards">Number of shards</h4>

<p>The number can be configured right from the module. It will be passed to Elasticsearch when creating the index. It is part of the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/_basic_concepts.html">basic concepts</a> of Elasticsearch.
Having an optimum value is vital to providing a fast search experience.</p>

<p>We recommend to never set this number below <code>2</code>.</p>

<h4 id="number-of-replicas">Number of replicas</h4>

<p>Like the number of shards, this can be changed right from the module as well and will be updated when creating the new index. Optimize this number for the best experience.
Due to the faceted search this module provides (and internal post-filter), we recommend to never set this number below <code>2</code>.</p>

<h4 id="index-prefix">Index prefix</h4>

<p>You can override the index prefix used. It is not necessary to assign a different one for every language or store you have.
thirty bees will automatically attach those numbers, meaning that if your basic prefix is <code>thirtybees</code>, for a shop with ID = 2 and language with ID = 1 it will automatically index at <code>thirtybees_2_1</code>.
This feature is useful if you run multiple instances of thirty bees on the same host that are not part of the same multistore instance.</p>

<h4 id="stop-words">Stop words</h4>

<p>For every language you can configure the stop words used by Elasticsearch. This is updated on every full reindex of Elasticsearch (click <code>Erase index</code> first).
You can extend or replace the default libraries used by Elasticsearch. I.e., the code <code>_english_</code> refers to the default list of stop words for English.</p>

<h4 id="enable-logging">Enable logging</h4>

<p><strong>Beta 2 remark</strong>: This option was supposed to provide more logging capabilities. As of beta 2 this feature does nothing and might get removed in a future release.</p>

<h3 id="connection"><i class="fa fa-plug"></i> Connection</h3>

<p>The connections tab allows you to configure the connection with the Elasticsearch server. This module also supports clusters (from both the frontend and backend).
From both the backend and frontend it uses round-robin for load-balancing.</p>

<h4 id="ajax-proxy">Ajax proxy</h4>

<p>The proxy button proxies all the servers to your frontend via the module&#39;s endpoint (<code>/module/elasticsearch/proxy</code> by default), otherwise the frontend search is sent to your servers directly.</p>

<h4 id="servers">Servers</h4>

<p>If you want to update the URLs, for example with the read-only URLs based on the the <code>.htpasswd</code> username/password combo you configured, you can update them on the <code>Connections</code> tab. Example of a configuration:
<img src="/thirtybees/images/merchants-guide/native-modules/elasticsearch/serverconfig.png" alt="server config" title="thirty bees elasticsearch server config"></p>

<p>The write and read setting tell the module which servers should be used for read operations and which should be used with write permissions. DO NOT MIX THE TWO: when a server/URL has write permission, DO NOT add the read permission!</p>

<h3 id="indexing"><i class="fa fa-sort"></i> Indexing</h3>

<p>This section allows you to configure how the module indexes your products.</p>

<p><a anchor="unique-codes"></a>  </p>

<blockquote>
<p>Note that there is a limitation on the features and attributes that can be indexed.
If you have a feature or attribute that after running it through <code>Tools::rewrite</code> (URL rewriting) generates the same code as an already existing property,
feature or attribute it will be ignored by thirty bees, since every single code has to be unique because of the way this module was built. For example, the data structures used by this module and 
direct URLs to searches all require unique codes. If you want to avoid collissions, make sure you rename your feature or attribute so it becomes visible and can be used by the module</p>

<p><strong>Beta 2 note: This limitation is probably the number one cause why the module does not index your products. If you cannot index your products, start searching for duplicates! We will improve error reporting with subsequent updates to make this process easier.</strong></p>
</blockquote>

<p>The module comes with a few default settings already prepared for optimal results. In case you need an example, this is what has been configured for a miniature car store:</p>

<p><img src="/thirtybees/images/merchants-guide/native-modules/elasticsearch/basicfields1.png" alt="basic fields" title="elasticsearch basic fields"></p>

<h3 id="search"><i class="fa fa-search"></i> Search</h3>

<p>On this tab you can select which fields should be used for search (YES / NO). Note that all these fields need to have the data type <code>text</code> if you are using fuzzy search, otherwise you can use both <code>text</code> and <code>keyword</code>.
It will generally be hard to use this this with other fields, so if Elasticsearch generates errors after changing this setting double-check if your fields all support search.</p>

<p>To make the search as solid as possible, sometimes the module decides to silently ignore fields. For instance, if you have configured <code>reference</code> to become a <code>long</code> (number) and you enable fuzzy search, then the module knows that his will not work with Elasticsearch and will not request the Elasticsearch server to use this field for search.</p>

<p>By default search suggestions (the autocomplete dropdown beneath the search bar) are sorted by relevance.
Elasticsearch has a smart scoring system that determines which results are more important.
The raw query editor on this search page will allow you to even further optimize this, but do note that the weights are very important. Choose them wisely.
More information on the scoring system of Elasticsearch can be found on <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/scoring-theory.html">this page</a>.</p>

<p>An example for the miniature car store:<br>
<img src="/thirtybees/images/merchants-guide/native-modules/elasticssearch/searchablefields.png" alt="searchable fields" title="elasticsearch searchable fields"></p>

<p>You can further tweak the raw search query. Do note that the placeholders <code>||QUERY||</code> and <code>||FIELDS||</code> will always have to be added, so if you want to adjust the query, find a way to place these essential variables first.
The default query can be found in the file <code>/modules/elasticsearch/data/defaultquery.json</code>:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
  <span class="nt">&quot;bool&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;must&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;multi_match&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;query&quot;</span><span class="p">:</span> <span class="err">||QUERY||</span><span class="p">,</span>
          <span class="nt">&quot;fields&quot;</span><span class="p">:</span> <span class="err">||FIELDS||</span><span class="p">,</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;best_fields&quot;</span><span class="p">,</span>
          <span class="nt">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;OR&quot;</span><span class="p">,</span>
          <span class="nt">&quot;fuzziness&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Be aware that this file does not contain valid JSON, but rather is a template for the module to use. The default one is suitable for most cases. The module shows what the placeholders will be replaced with:  </p>

<ul>
<li><code>||QUERY||</code> will be replaced with a string containing the search query: <code>&quot;search&quot;</code></li>
<li><code>||FIELDS||</code> will be replaced with the selected fields and their weights in an array, i.e.: <code>[&quot;name^4&quot;, &quot;description_short^2&quot;]</code></li>
</ul>

<h3 id="filter"><i class="fa fa-filter"></i> Filter</h3>

<p>Since this module provides faceted search you can also configure the facets or filters used on this page. Depending on the data type this page presents you with several configuration options.</p>

<p>You can enable/disable a filter with the YES/NO toggle. By default all filters are shown in a scrollable facet, meaning a scrollbar will show when there are a lot of options to choose from.
By default Elasticsearch returns an estimate of the amount of products that belong to a filter and not always all filters are shown. This is due to performance reasons and often the case if you have to show thousands of filters.
If you have a facet type that can return thousands of filters, then it is recommended to limit the amount of results shown seen the fact that a human brain cannot process that much information at once. Don&#39;t overwhelm your visitor!</p>

<p>As of beta 2 there are several filter styles available:
- <code>Checkbox</code>: the most common one, a simple checkbox
- <code>Slider</code>: A range slider, which is especially useful for prices
- <code>Color</code>: Shows a color checkbox, can only be used with color attributes</p>

<p>A filter can be either conjunctive (AND) or disjunctive (OR). If you want the visitor to select multiple values, you can use a disjunctive filter.</p>

<p>Every filter can be dragged and dropped on the <i class="fa fa-sort"></i> Indexing, <i class="fa fa-search"></i> Search and <i class="fa fa-filter"></i> Filter page. This changes the filter&#39;s position on the result columns on the front office when searching.</p>

<p>An example from the model car store:  </p>

<p><img src="/thirtybees/images/merchants-guide/native-modules/elasticsearch/filterexamples.png" alt="filter example" title="elasticsearch filter example"></p>

<h3 id="display"><i class="fa fa-desktop"></i> Display</h3>

<p>This section is used to configure what features are activated and how they are displayed on the front office.</p>

<h4 id="use-a-list-as-default-product-layout">Use a list as default product layout</h4>

<p>By default, the first time a visitors uses the search products are shown in a grid.
If the visitor prefers to show them in a list, this is then locally stored in the browser and on every subsequent search/site visit the module will always show the list instead.
When you want to display a list by default to visitors, right from the start, you can enable this option.</p>

<h4 id="replace-native-pages">Replace native pages</h4>

<p>This option replaces the native category, manufacturer and supplier pages, allowing to show you the blazing fast Elasticsearch results instead of the previous old-fashioned search options.</p>

<h4 id="search-in-subcategories-on-replaced-pages">Search in subcategories on replaced pages</h4>

<p>By default subcategories are shown but not searched in. If you want to show results from subcategories on the category pages, be sure to enable this option.</p>

<h4 id="autocomplete">Autocomplete</h4>

<p>The module can show search suggestions beneath the search bar. To show the 5 most popular options while searching, enable this option.</p>

<h4 id="instant-search">Instant search</h4>

<p>The option Instant search will directly replace the current page&#39;s content with instant search results. Every layout with a main column is supported.</p>

<h4 id="infinite-scroll">Infinite scroll</h4>

<p>If you would rather use infinite scroll instead of regular pagination, you can enable this option.</p>

<h4 id="price-slider-tax-rules-group">Price slider tax rules group</h4>

<p>There is a limitation to which taxes can be calculated real-time for the current user. The module can only index prices for one tax rules group at a time.
Therefore this option becomes important when you use a price slider. It will apply the selected tax rules group.
Note that products which belong to a different tax rules group might get incorrectly shown in the search result. In order to avoid confusing your visitors
it is recommended to disable price sliders if you have mixed tax rates in your store. </p>


    <div class="tags">
        
        <b>Tags: </b>
        



        
        
        <a href="/tag/elasticsearch/" class="btn btn-default navbar-btn cursorNorm" role="button">Elasticsearch</a>
        
        
        
        <a href="/tag/search/" class="btn btn-default navbar-btn cursorNorm" role="button">search</a>
        
        
        
        <a href="/tag/filtering/" class="btn btn-default navbar-btn cursorNorm" role="button">filtering</a>
        
        
        
        <a href="/tag/native-modules/" class="btn btn-default navbar-btn cursorNorm" role="button">Native modules</a>
        
        
        
    </div>

    

<div id="disqus_thread"></div>
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'thirty-bees'; // required: replace example with your forum shortname

	/* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



</div>



<footer>
	<div class="row">
		<div class="col-lg-12 footer">
			&copy;2019 thirty bees. All rights reserved. <br/>
			 Site last generated: Jun 29, 2019 <br/>
			<p><img src="" /></p>
                </div>
            </div>
</footer>


		</div>
	</div><!-- /.row -->
</div>    <!-- /.container -->


<div class="avada-noconflict">
	<div class="fusion-footer" id="fusion-footer">
		<footer id="footer" class="fusion-footer-copyright-area">
			<div class="fusion-row">
				<div class="fusion-copyright-content">
					<div class="fusion-copyright-notice" style="padding-bottom: 0px;">
						<div>Copyright 2019 thirty bees | all rights reserved</div>
					</div>
					<div class="fusion-social-links-footer" style="display: none;">
					</div>
				</div> <!-- fusion-fusion-copyright-content -->
			</div> <!-- fusion-row -->
		</footer>
	</div>
</div>
</body>


</html>

